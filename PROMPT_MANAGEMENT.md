# AI Prompt Management - Dokumentation

## √úbersicht

Das AI Featured Image Plugin verwendet ein flexibles Prompt-Management-System basierend auf WordPress Custom Post Types. Alle Prompts k√∂nnen √ºber die WordPress-Admin-Oberfl√§che verwaltet, angepasst und getestet werden.

## Custom Post Type: AI Prompts

### Zugriff

Im WordPress Admin unter: **AI Prompts** (Men√º-Icon: üìÑ)

Oder direkt: `http://localhost:8080/wp-admin/edit.php?post_type=ai_prompt`

### Features

- ‚úÖ Visuelle Verwaltung aller Prompts
- ‚úÖ Live-Testing mit OpenAI API
- ‚úÖ GPT-Parameter pro Prompt konfigurierbar
- ‚úÖ Versionierung durch WordPress Revisions
- ‚úÖ Varianten f√ºr verschiedene L√§ngen (short/medium/long/verylong)
- ‚úÖ Variablen-System f√ºr dynamische Inhalte
- ‚úÖ Aktiv/Inaktiv Status

## Prompt-Slugs (Referenz)

Das System verwendet folgende Standard-Prompts:

| Slug | Beschreibung | Typ | Varianten |
|------|--------------|-----|-----------|
| `system-post-generation` | System-Prompt f√ºr Post-Generierung | System | - |
| `system-correction` | System-Prompt f√ºr L√§ngenkorrektur | System | - |
| `post-generation` | User-Prompt f√ºr Post-Generierung | Generation | short, medium, long, verylong |
| `correction-expand` | Prompt zum Erweitern zu kurzer Texte | Correction | - |
| `correction-shorten` | Prompt zum K√ºrzen zu langer Texte | Correction | - |
| `image-generation` | Prompt f√ºr Bild-Generierung | Image | - |

## Prompt-Struktur

### Meta-Felder

#### 1. Prompt-Konfiguration

**Prompt-Slug** (erforderlich)
- Eindeutige Kennung
- Format: `kebab-case` (z.B. `post-generation`)
- Wird im Code zum Laden verwendet

**Prompt-Typ**
- `generation`: Post-Content-Generierung
- `correction_expand`: Content erweitern
- `correction_shorten`: Content k√ºrzen
- `system_generation`: System-Prompt f√ºr Generierung
- `system_correction`: System-Prompt f√ºr Korrektur
- `image`: Bild-Generierung

**Varianten (JSON)**

F√ºr Prompts mit mehreren Varianten (z.B. verschiedene L√§ngen):

```json
{
  "short": "Prompt-Text f√ºr kurze Beitr√§ge...",
  "medium": "Prompt-Text f√ºr mittellange Beitr√§ge...",
  "long": "Prompt-Text f√ºr lange Beitr√§ge...",
  "verylong": "Prompt-Text f√ºr sehr lange Beitr√§ge..."
}
```

#### 2. GPT-Parameter

**Modell**
- `gpt-5`: High-Performance ($1.25 / 1M tokens)
- `gpt-5-mini`: Balanced ($0.25 / 1M tokens) - **Empfohlen**
- `gpt-5-nano`: Fast & G√ºnstig ($0.05 / 1M tokens)
- `gpt-image-1`: Bild-Generierung

**Temperature** (0.0 - 2.0)
- `0.0 - 0.3`: Deterministisch, konsistent (empfohlen f√ºr Content-Generierung)
- `0.4 - 0.7`: Ausgewogen
- `0.8 - 2.0`: Kreativ, variabel

**Max Tokens**
- Maximale Anzahl Tokens in der Antwort
- Leer lassen f√ºr automatische Berechnung

**Response Format**
- `text`: Reine Text-Antwort
- `json_object`: Strukturierte JSON-Antwort (f√ºr Post-Generierung)

#### 3. Status

**Aktiv/Inaktiv**
- Nur aktive Prompts werden vom System verwendet
- Inaktive Prompts bleiben erhalten, werden aber nicht geladen

## Variablen-System

Prompts k√∂nnen Platzhalter enthalten, die automatisch ersetzt werden:

### Verf√ºgbare Variablen

| Variable | Beschreibung | Beispiel |
|----------|--------------|----------|
| `{post_title}` | Titel des Posts | "K√ºnstliche Intelligenz im Jahr 2025" |
| `{post_excerpt}` | Auszug des Posts | "Ein √úberblick √ºber..." |
| `{post_content}` | Inhalt des Posts (ohne HTML) | Volltext |
| `{min_words}` | Minimale Wortanzahl | 300 |
| `{max_words}` | Maximale Wortanzahl | 500 |
| `{current_words}` | Aktuelle Wortanzahl | 280 |
| `{length}` | L√§ngen-Parameter | short, medium, long, verylong |

### Verwendung in Prompts

```
Schreibe einen deutschen Artikel zum Thema: "{post_title}"

Kontext: {post_excerpt}

üéØ WORTANZAHL-ANFORDERUNG:
- Zielbereich: {min_words} bis {max_words} W√∂rter
```

## Redaktionelle Einstellungen

### Blattlinie, Schreibstil und Zielgruppe

Unter **Einstellungen ‚Üí AI Featured Image** k√∂nnen redaktionelle Vorgaben konfiguriert werden, die in System-Prompts verwendet werden:

#### Verf√ºgbare Variablen f√ºr System-Prompts

| Variable | Beschreibung | Beispiel |
|----------|--------------|----------|
| `{editorial_line}` | Blattlinie der Publikation | "Progressive, technologieaffine Publikation" |
| `{author_style}` | Gew√ºnschter Schreibstil | "Sachlich-informativ mit Beispielen" |
| `{target_audience}` | Zielgruppe | "Tech-interessierte Erwachsene 25-45" |

#### Konfiguration

1. Gehe zu **Einstellungen ‚Üí AI Featured Image**
2. Scrolle zum Abschnitt **"Redaktionelle Einstellungen"**
3. F√ºlle die Felder aus:
   - **Blattlinie**: Beschreibe die redaktionelle Linie deiner Publikation
   - **Schreibstil**: Definiere den gew√ºnschten Ton und Stil
   - **Zielgruppe**: Beschreibe deine Leserschaft

#### Beispiel System-Prompt mit Variablen

```
Du bist ein professioneller Content-Writer f√ºr deutsche Artikel.

BLATTLINIE: {editorial_line}
SCHREIBSTIL: {author_style}
ZIELGRUPPE: {target_audience}

Du schreibst Artikel auf Deutsch, die EXAKT die Wortzahl-Anforderungen erf√ºllen...
```

Die Variablen werden automatisch ersetzt, wenn der Prompt geladen wird.

## Prompt-Validierung

### Automatische Pr√ºfung

Beim Speichern eines Prompts wird dieser automatisch auf erforderliche Bestandteile gepr√ºft:

#### Validierungsregeln pro Typ

**Generation (`generation`)**
- Muss "JSON" und "Format" enthalten
- Muss "STRUKTUR" enthalten

**System-Generation (`system_generation`)**
- Muss "JSON" enthalten

**Korrektur Erweitern/K√ºrzen (`correction_expand`, `correction_shorten`)**
- Muss `{min_words}` und `{max_words}` enthalten

### Validierungsfehler

Bei fehlenden Bestandteilen erscheint eine Warnung:

```
‚ö†Ô∏è Prompt-Warnung:
‚Ä¢ Fehlt: json
‚Ä¢ Fehlt: structure

Der Prompt wurde gespeichert, enth√§lt aber m√∂glicherweise nicht alle erforderlichen Bestandteile.
```

Der Prompt wird trotzdem gespeichert, aber du solltest die fehlenden Teile erg√§nzen.

## Standard-Prompts

### System-Post-Generierung

```
Du bist ein professioneller Content-Writer f√ºr deutsche Artikel.

BLATTLINIE: {editorial_line}
SCHREIBSTIL: {author_style}
ZIELGRUPPE: {target_audience}

Du schreibst Artikel auf Deutsch, die EXAKT die Wortzahl-Anforderungen erf√ºllen. Du schreibst IMMER ALLE Abschnitte vollst√§ndig. Du antwortest IMMER mit g√ºltigem JSON mit den Feldern content_html, category_name und tags.
```

**Parameter:**
- Model: gpt-5-mini
- Temperature: 0.2
- Response Format: json_object

**Hinweis:** Die Variablen `{editorial_line}`, `{author_style}` und `{target_audience}` werden aus den Plugin-Einstellungen geladen.

### Post-Generierung (Variante: short)

```
Schreibe einen deutschen Artikel zum Thema: "{post_title}"

Kontext: {post_excerpt}

üéØ WORTANZAHL-ANFORDERUNG:
- Zielbereich: {min_words} bis {max_words} W√∂rter

STRUKTUR (5 Abschnitte):
1. Einleitung (~80 W√∂rter)
2. Was ist [Thema]? (~70 W√∂rter)
3. Hauptmerkmale (~70 W√∂rter)
4. Anwendung/Vorteile (~70 W√∂rter)
5. Fazit (~60 W√∂rter)

JSON-Format (NUR dies):
{
  "content_html": "HTML-Artikel",
  "category_name": "passende Kategorie",
  "tags": ["tag1", "tag2", "tag3", "tag4", "tag5", "tag6", "tag7"]
}
```

### Korrektur: Erweitern

```
Der folgende Artikel hat nur {current_words} W√∂rter, braucht aber {min_words}-{max_words} W√∂rter.

WICHTIG: Erweitere den Inhalt, indem du:
1. Bestehende Abschnitte mit mehr Details und Beispielen erweiterst
2. Tiefergehende Erkl√§rungen hinzuf√ºgst
3. Die Struktur und alle HTML-Tags beibeh√§ltst
4. NICHT neue Abschnitte hinzuf√ºgst

Aktueller Artikel:
{post_content}

Antworte NUR mit dem erweiterten HTML-Inhalt. Ziel: {min_words}-{max_words} W√∂rter.
```

**Parameter:**
- Model: gpt-5-mini
- Temperature: 0.3
- Max Tokens: 6000
- Response Format: text

### Bild-Generierung

```
Create a high-quality featured image for a blog post titled "{post_title}". The content is about: {post_excerpt}. Do not include any text, captions, labels, watermarks, typography, or logos in the image (text-free image).
```

**Parameter:**
- Model: gpt-image-1
- Temperature: 0.7
- Response Format: text

## Prompt erstellen

### Schritt-f√ºr-Schritt

1. **Neuer Prompt**
   - Gehe zu: AI Prompts ‚Üí Hinzuf√ºgen
   - Oder: http://localhost:8080/wp-admin/post-new.php?post_type=ai_prompt

2. **Titel eingeben**
   - Beschreibender Name (z.B. "Post-Generierung (mittel)")

3. **Prompt-Text**
   - Haupt-Content-Bereich
   - Verwende Variablen wo n√∂tig
   - Bei Varianten: Feld leer lassen und JSON in "Varianten" eintragen

4. **Konfiguration**
   - **Prompt-Slug**: Eindeutige ID (z.B. `custom-post-gen`)
   - **Prompt-Typ**: Passenden Typ w√§hlen
   - **Varianten**: Optional JSON mit Varianten

5. **GPT-Parameter**
   - **Modell**: gpt-5-mini (empfohlen f√ºr Start)
   - **Temperature**: 0.2 (f√ºr konsistente Ergebnisse)
   - **Max Tokens**: Abh√§ngig von erwarteter Antwortl√§nge
   - **Response Format**: text oder json_object

6. **Status**
   - ‚úì Prompt ist aktiv (anhaken)

7. **Ver√∂ffentlichen**
   - Button "Ver√∂ffentlichen" klicken

### Best Practices

#### Prompt-Writing

1. **Sei spezifisch**
   ```
   ‚ùå "Schreibe einen Artikel"
   ‚úÖ "Schreibe einen deutschen Artikel mit genau 5 Abschnitten..."
   ```

2. **Strukturiere klar**
   ```
   üéØ ANFORDERUNG:
   - Punkt 1
   - Punkt 2
   
   STRUKTUR:
   1. ...
   2. ...
   ```

3. **Nutze Variablen**
   ```
   ‚ùå "zum Thema [THEMA]"
   ‚úÖ "zum Thema: \"{post_title}\""
   ```

4. **Definiere Format**
   ```
   JSON-Format (NUR dies, kein zus√§tzlicher Text):
   {
     "field": "value"
   }
   ```

#### GPT-Parameter

**Temperature-Wahl:**
- Content-Generierung: `0.2` (konsistent)
- Kreative Texte: `0.7`
- Bild-Prompts: `0.7` (mehr Varianz)

**Modell-Wahl:**
- Komplexe Aufgaben: `gpt-5`
- Standard-Aufgaben: `gpt-5-mini` ‚≠ê
- Einfache Aufgaben: `gpt-5-nano`
- Bilder: `gpt-image-1`

## Prompt testen

### Im Editor

1. **Prompt √∂ffnen**
   - AI Prompts ‚Üí Prompt ausw√§hlen

2. **Test-Button**
   - Rechte Sidebar ‚Üí "Prompt testen"
   - Button "Prompt testen" klicken

3. **Test-Parameter**
   - **Test-Post ID**: Optional, f√ºr Variablen-Ersetzung
   - **Variante**: z.B. "short", "medium" (nur bei Varianten-Prompts)

4. **Test starten**
   - Button "Test starten"
   - Warten (30-120 Sekunden)

5. **Ergebnis pr√ºfen**
   - Token-Verwendung
   - Antwort-Vorschau
   - Fehlermeldungen

### Testergebnis

**Erfolg:**
- ‚úÖ Gr√ºne Meldung
- Token-Statistik
- Antwort-Vorschau
- Wird im Prompt gespeichert

**Fehler:**
- ‚ùå Rote Meldung
- Fehlerbeschreibung
- M√∂gliche Ursachen pr√ºfen

## Prompt bearbeiten

### Workflow

1. **√ñffnen**
   - AI Prompts ‚Üí Prompt ausw√§hlen
   - Oder: Dashboard ‚Üí Prompt-Verwaltung ‚Üí Bearbeiten

2. **√Ñndern**
   - Text anpassen
   - Parameter optimieren
   - Status √§ndern

3. **Testen**
   - Mit Test-Funktion validieren
   - Ergebnis pr√ºfen

4. **Aktualisieren**
   - Button "Aktualisieren"
   - Cache wird automatisch geleert

### Versionierung

**WordPress Revisions:**
- Alle √Ñnderungen werden gespeichert
- Revision-Vergleich verf√ºgbar
- Wiederherstellen m√∂glich

**Zugriff:**
- Editor ‚Üí Rechte Sidebar ‚Üí "Revisionen"
- Diff-Ansicht
- Wiederherstellen-Button

## Troubleshooting

### Prompt wird nicht gefunden

**Fehler:** _"Prompt 'xyz' nicht gefunden"_

**L√∂sung:**
1. Pr√ºfen ob Prompt existiert: AI Prompts
2. Pr√ºfen ob Slug korrekt ist
3. Pr√ºfen ob Status "Aktiv"
4. Cache leeren (Prompt speichern)

### Test schl√§gt fehl

**API Key fehlt:**
- Einstellungen ‚Üí AI Featured Image
- OpenAI API Key eintragen

**Timeout:**
- Max Tokens reduzieren
- Einfacheres Modell w√§hlen (gpt-5-nano)

**Ung√ºltige Antwort:**
- Response Format pr√ºfen
- Prompt-Anweisungen klarer formulieren

### Variablen werden nicht ersetzt

**Problem:** Variablen erscheinen als `{post_title}` im generierten Content

**L√∂sung:**
- Test-Post ID angeben beim Testen
- Pr√ºfen ob Variablen-Namen korrekt sind
- Pr√ºfen ob Gro√ü-/Kleinschreibung stimmt

### Performance-Probleme

**Langsame Generierung:**
- Kleineres Modell: gpt-5-mini statt gpt-5
- Max Tokens reduzieren
- Prompt vereinfachen

**Hohe Kosten:**
- gpt-5-nano f√ºr einfache Aufgaben
- Max Tokens limitieren
- Temperature senken (weniger Tokens)

## Integration im Code

### Prompt laden

```php
$loader = new AI_Featured_Image_Prompt_Loader();

// Einfacher Prompt
$prompt = $loader->get_prompt_by_slug( 'system-post-generation' );

// Mit Variante
$prompt = $loader->get_prompt_by_slug( 'post-generation', 'medium' );

// Mit Variablen
$variables = array(
    'post_title' => 'Mein Titel',
    'min_words' => 300,
    'max_words' => 500
);
$prompt = $loader->get_prompt_by_slug( 'post-generation', 'short', $variables );
```

### Konfiguration laden

```php
$config = $loader->get_prompt_config( 'post-generation' );

$model = $config['model']; // z.B. 'gpt-5-mini'
$temperature = $config['temperature']; // z.B. 0.2
$max_tokens = $config['max_tokens'];
$response_format = $config['response_format'];
```

### Fehlerbehandlung

```php
try {
    $prompt = $loader->get_prompt_by_slug( 'my-prompt' );
} catch ( Exception $e ) {
    // Prompt fehlt - zeige Fehler
    error_log( $e->getMessage() );
    // Fallback oder Abbruch
}
```

## API-Dokumentation

### REST API

Keine direkte REST API f√ºr Prompts (verwendet WordPress Post API).

### WP-CLI

```bash
# Prompts listen
wp post list --post_type=ai_prompt

# Prompt erstellen
wp post create --post_type=ai_prompt \
  --post_title="Mein Prompt" \
  --post_content="Prompt-Text..." \
  --post_status=publish

# Meta setzen
wp post meta set POST_ID _prompt_slug "my-prompt"
wp post meta set POST_ID _gpt_model "gpt-5-mini"
wp post meta set POST_ID _is_active "1"
```

## Beispiele

### Beispiel 1: Custom Post-Generierungs-Prompt

**Szenario:** Spezieller Prompt f√ºr Tech-Artikel

**Schritte:**
1. Neuer Prompt erstellen
2. Titel: "Tech-Artikel Generierung"
3. Slug: `tech-post-generation`
4. Typ: `generation`
5. Prompt-Text:
   ```
   Schreibe einen technischen Artikel zum Thema: "{post_title}"
   
   Zielgruppe: IT-Professionals
   Ton: Technisch, pr√§zise
   
   STRUKTUR:
   1. Executive Summary
   2. Technische Details
   3. Implementation
   4. Best Practices
   5. Conclusion
   
   Wortanzahl: {min_words}-{max_words}
   
   JSON-Format:
   {
     "content_html": "...",
     "category_name": "Technology",
     "tags": ["tech", "..."]
   }
   ```
6. Modell: gpt-5
7. Temperature: 0.3
8. Response Format: json_object
9. Aktiv: ‚úì
10. Ver√∂ffentlichen

**Verwendung im Code:**
```php
$prompt = $loader->get_prompt_by_slug( 'tech-post-generation', null, $variables );
```

### Beispiel 2: Multi-Sprachen-Prompt

**Szenario:** Prompts f√ºr verschiedene Sprachen

**Varianten-JSON:**
```json
{
  "de": "Schreibe einen deutschen Artikel...",
  "en": "Write an English article...",
  "fr": "√âcrivez un article fran√ßais..."
}
```

**Verwendung:**
```php
$prompt = $loader->get_prompt_by_slug( 'multi-lang-post', 'de', $variables );
```

## Zusammenfassung

Das Prompt-Management-System bietet:

‚úÖ **Flexibilit√§t**: Alle Prompts anpassbar  
‚úÖ **Transparenz**: Sichtbare Konfiguration  
‚úÖ **Testbarkeit**: Live-Testing m√∂glich  
‚úÖ **Versionierung**: √Ñnderungen nachvollziehbar  
‚úÖ **Performance**: Effizientes Caching  
‚úÖ **Sicherheit**: Fehlerbehandlung integriert  

**N√§chste Schritte:**
1. Standard-Prompts pr√ºfen und bei Bedarf anpassen
2. Eigene Prompts f√ºr spezielle Anwendungsf√§lle erstellen
3. Regelm√§√üig testen und optimieren
4. Dashboard f√ºr schnellen √úberblick nutzen

